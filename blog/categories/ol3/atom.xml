<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">

  <title><![CDATA[Category: ol3, | Spaghetti Code]]></title>
  <link href="http://thostetler.github.io/blog/categories/ol3/atom.xml" rel="self"/>
  <link href="http://thostetler.github.io/"/>
  <updated>2016-03-08T16:50:01-05:00</updated>
  <id>http://thostetler.github.io/</id>
  <author>
    <name><![CDATA[Tim Hostetler]]></name>
    
  </author>
  <generator uri="http://octopress.org/">Octopress</generator>

  
  <entry>
    <title type="html"><![CDATA[OL3 Custom Element: Parameters]]></title>
    <link href="http://thostetler.github.io/blog/2016/02/12/ol3-custom-element-parameters/"/>
    <updated>2016-02-12T22:28:24-05:00</updated>
    <id>http://thostetler.github.io/blog/2016/02/12/ol3-custom-element-parameters</id>
    <content type="html"><![CDATA[<p>Now that we have our custom element created and the bindings are set up we can start to add in parameters to pass options to our new map.  Currently Knockout provides this utility for passing params to custom components: <code>&lt;component params="{...}"&gt;&lt;/component&gt;</code>.  This is fine, but it would be cool to provide our options through element attributes.</p>

<p><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='html'><span class='line'><span class="nt">&lt;ol3map</span> <span class="na">params=</span><span class="s">&quot;center: [0, 0], zoom: 2&quot;</span><span class="nt">&gt;&lt;/ol3map&gt;</span>
</span></code></pre></td></tr></table></div></figure></p>

<p>Params are certainly useful, but I think something like this seems more intuitive:</p>

<p><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='html'><span class='line'><span class="nt">&lt;ol3map</span> <span class="na">center=</span><span class="s">&quot;[0, 0]&quot;</span> <span class="na">zoom=</span><span class="s">&quot;2&quot;</span><span class="nt">&gt;&lt;/ol3map&gt;</span>
</span></code></pre></td></tr></table></div></figure></p>

<p>We&rsquo;ll want to add in support for these attributes and pass these options along to our map.  This should be easy enough to do.  Just parse out these attributes and pass the options.  Here is a simple example of an attribute parser with default options:</p>

<p><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
</pre></td><td class='code'><pre><code class='js'><span class='line'><span class="kd">var</span> <span class="nx">parseOptions</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">options</span><span class="p">,</span> <span class="nx">element</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>  <span class="k">if</span> <span class="p">(</span><span class="nx">options</span><span class="p">.</span><span class="nx">$raw</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>    <span class="k">delete</span> <span class="nx">options</span><span class="p">.</span><span class="nx">$raw</span><span class="p">;</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>  <span class="nb">Array</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">slice</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">element</span><span class="p">.</span><span class="nx">attributes</span><span class="p">).</span><span class="nx">forEach</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">k</span><span class="p">,</span> <span class="nx">i</span><span class="p">,</span> <span class="nx">a</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>    <span class="c1">// Skip params attribute</span>
</span><span class='line'>    <span class="k">if</span> <span class="p">(</span><span class="nx">a</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">name</span> <span class="o">===</span> <span class="o">&amp;</span><span class="nx">lsquo</span><span class="p">;</span><span class="nx">params</span><span class="o">&amp;</span><span class="nx">rsquo</span><span class="p">;)</span> <span class="p">{</span>
</span><span class='line'>      <span class="k">return</span><span class="p">;</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>    <span class="kd">var</span> <span class="nx">v</span> <span class="o">=</span> <span class="nx">a</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">value</span><span class="p">;</span>
</span><span class='line'>    <span class="k">if</span> <span class="p">(</span><span class="nx">v</span><span class="p">.</span><span class="nx">match</span><span class="p">(</span><span class="sr">/^(/</span><span class="p">))</span> <span class="p">{</span>
</span><span class='line'>      <span class="nx">options</span><span class="p">[</span><span class="nx">a</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">name</span><span class="p">]</span> <span class="o">=</span> <span class="nb">eval</span><span class="p">(</span><span class="nx">v</span><span class="p">);</span>
</span><span class='line'>    <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">v</span><span class="p">.</span><span class="nx">match</span><span class="p">(</span><span class="sr">/^[[{\d]/</span><span class="p">))</span> <span class="p">{</span>
</span><span class='line'>      <span class="nx">options</span><span class="p">[</span><span class="nx">a</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">name</span><span class="p">]</span> <span class="o">=</span> <span class="nx">JSON</span><span class="p">.</span><span class="nx">parse</span><span class="p">(</span><span class="nx">v</span><span class="p">);</span>
</span><span class='line'>    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span><span class='line'>      <span class="nx">options</span><span class="p">[</span><span class="nx">a</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">name</span><span class="p">]</span> <span class="o">=</span> <span class="nx">v</span><span class="p">;</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>  <span class="p">});</span>
</span><span class='line'>  <span class="k">return</span> <span class="nx">options</span><span class="p">;</span>
</span><span class='line'><span class="p">};</span>
</span></code></pre></td></tr></table></div></figure></p>

<p>Since <code>element.attributes</code> is actually a
<a href="//developer.mozilla.org/en-US/docs/Web/API/NamedNodeMap">NamedNodeMap</a> which,
similar to the <code>attributes</code> object can be converted to an array.  We can
convert the <code>element.attributes</code> object to an array by doing a <code>slice</code> and
looping through each attribute, attaching each to the <code>options</code> object as we
go.  Finally, extend the options object using some defaults we added.  Also,
to make sure that we get the right values we&rsquo;ll need to watch out for things
to parse.  So for example when we have <code>sourceProjection="EPSG:4326"</code> the
quotes are stripped and the flat string is sent to <code>JSON.parse</code> and it doesn&rsquo;t
know what to do with it yeilding this helpful message: <code>Uncaught SyntaxError:
Unexpected token E</code>.  So let&rsquo;s look out for parseable strings, for example:</p>

<p><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='js'><span class='line'><span class="c1">// For now I am just eval()-ing things that start with &amp;ldquo;(&amp;rdquo;</span>
</span><span class='line'><span class="c1">// definetly bad practice, but for this example it should be fine</span>
</span><span class='line'><span class="k">if</span> <span class="p">(</span><span class="nx">v</span><span class="p">.</span><span class="nx">match</span><span class="p">(</span><span class="sr">/^(/</span><span class="p">))</span> <span class="p">{</span>
</span><span class='line'>  <span class="c1">// eval() the result</span>
</span><span class='line'>  <span class="c1">// this way (Infinity), for example, doesn&amp;rsquo;t end up as a string &amp;ldquo;(Infinity)&amp;rdquo;</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'><span class="nx">v</span><span class="p">.</span><span class="nx">match</span><span class="p">(</span><span class="sr">/^[[{\d]/</span><span class="p">))</span>
</span><span class='line'><span class="c1">// Match on arrays, objects, or numbers</span>
</span></code></pre></td></tr></table></div></figure></p>

<p>Okay! so now we can do something like this:</p>

<p><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='html'><span class='line'><span class="nt">&lt;ol3map</span>
</span><span class='line'>  <span class="na">params=</span><span class="s">&quot;</span>
</span><span class='line'><span class="s">    center: [-40, 40],</span>
</span><span class='line'><span class="s">    zoom: 2</span>
</span><span class='line'><span class="s">  &quot;</span>
</span><span class='line'>  <span class="na">rotation=</span><span class="s">&quot;90&quot;</span>
</span><span class='line'>  <span class="na">sourceProjection=</span><span class="s">&quot;EPSG:4326</span>
</span><span class='line'><span class="s">&quot;</span><span class="nt">&gt;&lt;/ol3map&gt;</span>
</span></code></pre></td></tr></table></div></figure></p>

<p>and everything should work fine.  Here you can see it working great with our new customizable map element:</p>

<iframe width="100%" height="300" src="//jsfiddle.net/timh06/x5mmyb1x/embedded/result,html,js/" allowfullscreen="allowfullscreen" frameborder="0"></iframe>


<p>Now, what about one of the most important features of maps: layers.  We certainly want to be able to give the ability to add layers, and something like this isn&rsquo;t a terrible idea:</p>

<p><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class='html'><span class='line'><span class="ni">&amp;lt;</span>ol3map
</span><span class='line'>  center=<span class="ni">&amp;ldquo;</span>[-79, 40]<span class="ni">&amp;rdquo;</span>
</span><span class='line'>  rotation=<span class="ni">&amp;ldquo;</span>90<span class="ni">&amp;rdquo;</span>
</span><span class='line'>  layers=<span class="ni">&amp;ldquo;</span>[
</span><span class='line'>    { type: <span class="ni">&amp;lsquo;</span>Tile<span class="ni">&amp;rsquo;</span>, title: <span class="ni">&amp;lsquo;</span>Base Layer<span class="ni">&amp;rsquo;</span>, source: <span class="ni">&amp;lsquo;</span>OSM<span class="ni">&amp;rsquo;</span> },
</span><span class='line'>    { type: <span class="ni">&amp;lsquo;</span>Vector<span class="ni">&amp;rsquo;</span>, title: <span class="ni">&amp;lsquo;</span>Feature Layer<span class="ni">&amp;rsquo;</span>, source: <span class="ni">&amp;lsquo;</span>myLayers<span class="ni">&amp;rsquo;</span> }
</span><span class='line'>  ]<span class="ni">&amp;rdquo;</span><span class="nt">&lt;/p&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="nt">&lt;blockquote&gt;&lt;p&gt;&lt;/ol3map&gt;</span>
</span></code></pre></td></tr></table></div></figure></p></blockquote>

<p>But I think it makes a lot of sense to have these layers be represented visually in the markup by full sub-components under the main map, for example:</p>

<p><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='html'><span class='line'><span class="nt">&lt;ol3map</span> <span class="na">center=</span><span class="s">&quot;[-79, 40]&quot;</span> <span class="na">rotation=</span><span class="s">&quot;90&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>  <span class="nt">&lt;ol3layer</span> <span class="na">type=</span><span class="s">&quot;Tile&quot;</span> <span class="na">title=</span><span class="s">&quot;Base Layer&quot;</span> <span class="na">source=</span><span class="s">&quot;OSM&quot;</span><span class="nt">&gt;&lt;/ol3layer&gt;</span>
</span><span class='line'>  <span class="nt">&lt;ol3layer</span> <span class="na">type=</span><span class="s">&quot;Tile&quot;</span> <span class="na">title=</span><span class="s">&quot;Feature Layer&quot;</span> <span class="na">source=</span><span class="s">&quot;myLayers&quot;</span><span class="nt">&gt;&lt;/ol3layer&gt;</span>
</span><span class='line'><span class="nt">&lt;/ol3map&gt;</span>
</span></code></pre></td></tr></table></div></figure></p>

<p>This makes our code a little bit more complicated though now as we are going to have to figure out how to handle bindings on the child elements.  The simple part, however, is registering the component - we can do that the same way we made the <code>&lt;ol3map&gt;</code> element.  Let&rsquo;s take a look at the <code>componentInfo.templateNodes</code> property, this is just DOM nodes that Knockout found between our custom component tags which it passes to us, all we have to do is place them back into the DOM and they&rsquo;ll be bound by Knockout.  Which means that if we have a custom component inside of our custom component we can get it to bind as well.  The simplest way to do this, I&rsquo;ve found, is to just use the template nodes directly in the binding handler.  For example:</p>

<h2>Create Custom Binding (Root)</h2>

<p><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='js'><span class='line'><span class="nx">ko</span><span class="p">.</span><span class="nx">bindingHandlers</span><span class="p">.</span><span class="nx">__map</span> <span class="o">=</span> <span class="p">{</span>
</span><span class='line'>    <span class="nx">init</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">element</span><span class="p">,</span> <span class="nx">valueAccessor</span><span class="p">,</span> <span class="nx">allBindings</span><span class="p">,</span> <span class="nx">vm</span><span class="p">,</span> <span class="nx">context</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>        <span class="nx">$</span><span class="p">(</span><span class="nx">element</span><span class="p">).</span><span class="nx">html</span><span class="p">(</span><span class="nx">vm</span><span class="p">.</span><span class="nx">templateNodes</span><span class="p">);</span>
</span><span class='line'>        <span class="nx">vm</span><span class="p">.</span><span class="nx">viewModel</span><span class="p">.</span><span class="nx">map</span><span class="p">.</span><span class="nx">setTarget</span><span class="p">(</span><span class="nx">element</span><span class="p">);</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'><span class="p">};</span>
</span></code></pre></td></tr></table></div></figure></p>

<p>When we get passed the template nodes, just fill the html back in with the nodes, this will make Knockout rebind them.  We can then do any additional work here.</p>

<h2>Create Custom Component (Root)</h2>

<p><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
</pre></td><td class='code'><pre><code class='js'><span class='line'><span class="nx">ko</span><span class="p">.</span><span class="nx">components</span><span class="p">.</span><span class="nx">register</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">lsquo</span><span class="p">;</span><span class="nx">ol3map</span><span class="o">&amp;</span><span class="nx">rsquo</span><span class="p">;,</span> <span class="p">{</span>
</span><span class='line'>  <span class="nx">viewModel</span><span class="o">:</span> <span class="p">{</span>
</span><span class='line'>    <span class="nx">createViewModel</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">params</span><span class="p">,</span> <span class="nx">componentInfo</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>      <span class="k">return</span> <span class="p">{</span>
</span><span class='line'>        <span class="nx">viewModel</span><span class="o">:</span> <span class="k">new</span> <span class="nx">MapViewModel</span><span class="p">(</span><span class="nx">params</span><span class="p">,</span> <span class="nx">componentInfo</span><span class="p">.</span><span class="nx">element</span><span class="p">),</span>
</span><span class='line'>        <span class="nx">templateNodes</span><span class="o">:</span> <span class="nx">componentInfo</span><span class="p">.</span><span class="nx">templateNodes</span>
</span><span class='line'>      <span class="p">};</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>  <span class="p">},</span>
</span><span class='line'>  <span class="nx">template</span><span class="o">:</span> <span class="o">&amp;</span><span class="nx">lsquo</span><span class="p">;</span><span class="o">&lt;</span><span class="nx">div</span> <span class="nx">data</span><span class="o">-</span><span class="nx">bind</span><span class="o">=</span><span class="s2">&quot;__map&quot;</span><span class="o">&gt;&lt;</span><span class="err">/div&gt;&amp;rsquo;</span>
</span><span class='line'><span class="p">});</span>
</span></code></pre></td></tr></table></div></figure></p>

<p>Return an object containing the <code>viewmodel</code> and the <code>templateNodes</code>, then make sure the template has custom binding handler being called.</p>

<p>Now, assuming we have some child nodes containing custom components, we&rsquo;ll want to do the same thing for each of those:</p>

<h2>Create Custom Binding (Child)</h2>

<p><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='js'><span class='line'><span class="nx">ko</span><span class="p">.</span><span class="nx">bindingHandlers</span><span class="p">.</span><span class="nx">__layer</span> <span class="o">=</span> <span class="p">{</span>
</span><span class='line'>    <span class="nx">init</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">element</span><span class="p">,</span> <span class="nx">valueAccessor</span><span class="p">,</span> <span class="nx">allBindings</span><span class="p">,</span> <span class="nx">vm</span><span class="p">,</span> <span class="nx">context</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>        <span class="nx">$</span><span class="p">(</span><span class="nx">element</span><span class="p">).</span><span class="nx">html</span><span class="p">(</span><span class="nx">vm</span><span class="p">.</span><span class="nx">templateNodes</span><span class="p">);</span>
</span><span class='line'>        <span class="kd">var</span> <span class="nx">map</span> <span class="o">=</span> <span class="nx">context</span><span class="p">.</span><span class="nx">$parent</span><span class="p">.</span><span class="nx">viewModel</span><span class="p">.</span><span class="nx">map</span><span class="p">;</span>
</span><span class='line'>        <span class="nx">map</span><span class="p">.</span><span class="nx">addLayer</span><span class="p">(</span><span class="nx">vm</span><span class="p">.</span><span class="nx">viewModel</span><span class="p">);</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'><span class="p">};</span>
</span></code></pre></td></tr></table></div></figure></p>

<p>Same thing as the <code>root</code>, the only difference is that if you need access to the parent (<code>root</code>) viewmodel, we can do that through the <code>context.$parent</code> property.  Then it&rsquo;s pretty simple really to do our hookup, also notice we&rsquo;re passing our <code>templateNodes</code> through in case we have more child components.</p>

<h2>Create Custom Component (Child)</h2>

<p><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
</pre></td><td class='code'><pre><code class='js'><span class='line'><span class="nx">ko</span><span class="p">.</span><span class="nx">components</span><span class="p">.</span><span class="nx">register</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">lsquo</span><span class="p">;</span><span class="nx">ol3layer</span><span class="o">&amp;</span><span class="nx">rsquo</span><span class="p">;,</span> <span class="p">{</span>
</span><span class='line'>  <span class="nx">viewModel</span><span class="o">:</span> <span class="p">{</span>
</span><span class='line'>    <span class="nx">createViewModel</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">params</span><span class="p">,</span> <span class="nx">componentInfo</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>      <span class="k">return</span> <span class="p">{</span>
</span><span class='line'>        <span class="nx">viewModel</span><span class="o">:</span> <span class="k">new</span> <span class="nx">LayerViewModel</span><span class="p">(</span><span class="nx">params</span><span class="p">,</span> <span class="nx">componentInfo</span><span class="p">.</span><span class="nx">element</span><span class="p">),</span>
</span><span class='line'>        <span class="nx">templateNodes</span><span class="o">:</span> <span class="nx">componentInfo</span><span class="p">.</span><span class="nx">templateNodes</span>
</span><span class='line'>      <span class="p">};</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>  <span class="p">},</span>
</span><span class='line'>  <span class="nx">template</span><span class="o">:</span> <span class="o">&amp;</span><span class="nx">lsquo</span><span class="p">;</span><span class="o">&lt;</span><span class="nx">div</span> <span class="nx">data</span><span class="o">-</span><span class="nx">bind</span><span class="o">=</span><span class="s2">&quot;__layer&quot;</span><span class="o">&gt;&lt;</span><span class="err">/div&gt;&amp;rsquo;</span>
</span><span class='line'><span class="p">});</span>
</span></code></pre></td></tr></table></div></figure></p>

<p>Now we should be able to do something like this:</p>

<p><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='html'><span class='line'><span class="nt">&lt;ol3map</span> <span class="na">center=</span><span class="s">&quot;[-79, 40]&quot;</span> <span class="na">zoom=</span><span class="s">&quot;12&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>  <span class="nt">&lt;ol3layer</span> <span class="na">title=</span><span class="s">&quot;Base Layer&quot;</span> <span class="na">source=</span><span class="s">&quot;OSM&quot;</span><span class="nt">&gt;&lt;/ol3layer&gt;</span>
</span><span class='line'><span class="nt">&lt;/ol3map&gt;</span>
</span></code></pre></td></tr></table></div></figure></p>

<p>That&rsquo;s great, but what about the case where we would like to pass options to that source.  Could use something like <code>sourceOptions</code>, but that would break up the clean look of these attributes, so let&rsquo;s keep digging deeper.</p>

<p><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='html'><span class='line'><span class="nt">&lt;ol3map</span> <span class="na">center=</span><span class="s">&quot;[-79, 40]&quot;</span> <span class="na">zoom=</span><span class="s">&quot;12&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>  <span class="nt">&lt;ol3layer</span> <span class="na">title=</span><span class="s">&quot;Base Layer&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>     <span class="nt">&lt;ol3source</span> <span class="na">source=</span><span class="s">&quot;OSM&quot;</span><span class="nt">&gt;&lt;/ol3source&gt;</span>
</span><span class='line'>  <span class="nt">&lt;/ol3layer&gt;</span>
</span><span class='line'><span class="nt">&lt;/ol3map&gt;</span>
</span></code></pre></td></tr></table></div></figure></p>

<p>I think this is a clean way of visually representing our map.  By the way, the viewmodels for each of these are relatively simple, for this demo I&rsquo;m really just passing things right through to OL3.  For an example of this, check out the <code>SourceViewModel</code>:</p>

<p><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class='js'><span class='line'><span class="kd">function</span> <span class="nx">SourceViewModel</span> <span class="p">(</span><span class="nx">options</span><span class="p">,</span> <span class="nx">element</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>  <span class="nx">options</span> <span class="o">=</span> <span class="nx">ko</span><span class="p">.</span><span class="nx">utils</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
</span><span class='line'>    <span class="nx">source</span><span class="o">:</span> <span class="o">&amp;</span><span class="nx">lsquo</span><span class="p">;</span><span class="nx">OSM</span><span class="o">&amp;</span><span class="nx">rsquo</span><span class="p">;</span>
</span><span class='line'>  <span class="p">},</span> <span class="nx">parseOptions</span><span class="p">(</span><span class="nx">options</span><span class="p">,</span> <span class="nx">element</span><span class="p">));</span><span class="o">&lt;</span><span class="err">/p&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="nx">p</span><span class="o">&gt;</span>  <span class="kd">var</span> <span class="nx">source</span> <span class="o">=</span> <span class="nx">options</span><span class="p">.</span><span class="nx">source</span><span class="p">;</span>
</span><span class='line'>  <span class="k">delete</span> <span class="nx">options</span><span class="p">.</span><span class="nx">source</span><span class="p">;</span><span class="o">&lt;</span><span class="err">/p&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="nx">p</span><span class="o">&gt;</span>  <span class="k">return</span> <span class="k">new</span> <span class="nx">ol</span><span class="p">.</span><span class="nx">source</span><span class="o">&lt;</span><span class="nx">a</span> <span class="nx">href</span><span class="o">=</span><span class="s2">&quot;options&quot;</span><span class="o">&gt;</span><span class="nx">source</span><span class="o">&lt;</span><span class="err">/a&gt;;</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure></p>

<p>That <code>parseOptions</code> part takes that <code>options</code> object and adds in any of the attributes it found on the element passed in.  Then we just create a new source object, passing in options - pretty simple.</p>

<p>The final thing to worry about is <code>Features</code>, these are part of <code>source</code>, and more specifically, <code>ol.source.Vector</code>.  So we are looking for something like this:</p>

<p><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='html'><span class='line'><span class="nt">&lt;ol3layer</span> <span class="na">title=</span><span class="s">&quot;feature layer&quot;</span> <span class="na">type=</span><span class="s">&quot;Vector&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>  <span class="nt">&lt;ol3source</span> <span class="na">source=</span><span class="s">&quot;Vector&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>    <span class="nt">&lt;ol3feature</span> <span class="na">geometry=</span><span class="s">&quot;Point&quot;</span> <span class="na">location=</span><span class="s">&quot;[-79, 40]&quot;</span><span class="nt">&gt;&lt;/ol3feature&gt;</span>
</span><span class='line'>    <span class="nt">&lt;ol3feature</span> <span class="na">geometry=</span><span class="s">&quot;Point&quot;</span> <span class="na">location=</span><span class="s">&quot;[-79, 40.009]&quot;</span><span class="nt">&gt;&lt;/ol3feature&gt;</span>
</span><span class='line'>    <span class="nt">&lt;ol3feature</span> <span class="na">geometry=</span><span class="s">&quot;Point&quot;</span> <span class="na">location=</span><span class="s">&quot;[-79, 40.005]&quot;</span><span class="nt">&gt;&lt;/ol3feature&gt;</span>
</span><span class='line'>  <span class="nt">&lt;/ol3source&gt;</span>
</span><span class='line'><span class="nt">&lt;/ol3layer&gt;</span>
</span></code></pre></td></tr></table></div></figure></p>

<p>This is done the same way as the others, just create a custom component for the new <code>ol3feature</code> tag:</p>

<p><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='js'><span class='line'><span class="nx">ko</span><span class="p">.</span><span class="nx">components</span><span class="p">.</span><span class="nx">register</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">lsquo</span><span class="p">;</span><span class="nx">ol3feature</span><span class="o">&amp;</span><span class="nx">rsquo</span><span class="p">;,</span> <span class="p">{</span>
</span><span class='line'>  <span class="nx">viewModel</span><span class="o">:</span> <span class="p">{</span>
</span><span class='line'>    <span class="nx">createViewModel</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">params</span><span class="p">,</span> <span class="nx">componentInfo</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>      <span class="k">return</span> <span class="k">new</span> <span class="nx">FeatureViewModel</span><span class="p">(</span><span class="nx">params</span><span class="p">,</span> <span class="nx">componentInfo</span><span class="p">.</span><span class="nx">element</span><span class="p">);</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>  <span class="p">},</span>
</span><span class='line'>  <span class="nx">template</span><span class="o">:</span> <span class="o">&amp;</span><span class="nx">lsquo</span><span class="p">;</span><span class="o">&lt;</span><span class="nx">div</span> <span class="nx">data</span><span class="o">-</span><span class="nx">bind</span><span class="o">=</span><span class="s2">&quot;__feature&quot;</span><span class="o">&gt;&lt;</span><span class="err">/div&gt;&amp;rsquo;</span>
</span><span class='line'><span class="p">});</span>
</span></code></pre></td></tr></table></div></figure></p>

<p>Add the feature to the parent source from within the binding handler and we&rsquo;re good:</p>

<p><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='js'><span class='line'><span class="nx">ko</span><span class="p">.</span><span class="nx">bindingHandlers</span><span class="p">.</span><span class="nx">__feature</span> <span class="o">=</span> <span class="p">{</span>
</span><span class='line'>    <span class="nx">init</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">element</span><span class="p">,</span> <span class="nx">valueAccessor</span><span class="p">,</span> <span class="nx">allBindings</span><span class="p">,</span> <span class="nx">vm</span><span class="p">,</span> <span class="nx">context</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>        <span class="kd">var</span> <span class="nx">source</span> <span class="o">=</span> <span class="nx">context</span><span class="p">.</span><span class="nx">$parent</span><span class="p">.</span><span class="nx">viewModel</span><span class="p">;</span>
</span><span class='line'>        <span class="nx">source</span><span class="p">.</span><span class="nx">addFeature</span><span class="p">(</span><span class="nx">vm</span><span class="p">);</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'><span class="p">};</span>
</span></code></pre></td></tr></table></div></figure></p>

<p>Cool! now the final markup looks like this:</p>

<p><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
</pre></td><td class='code'><pre><code class='html'><span class='line'><span class="nt">&lt;ol3map</span> <span class="na">center=</span><span class="s">&quot;[-79, 40]&quot;</span> <span class="na">zoom=</span><span class="s">&quot;12&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>  <span class="nt">&lt;ol3layer</span> <span class="na">title=</span><span class="s">&quot;Base Layer&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>     <span class="nt">&lt;ol3source</span> <span class="na">source=</span><span class="s">&quot;OSM&quot;</span><span class="nt">&gt;&lt;/ol3source&gt;</span>
</span><span class='line'>  <span class="nt">&lt;/ol3layer&gt;</span>
</span><span class='line'>  <span class="nt">&lt;ol3layer</span> <span class="na">title=</span><span class="s">&quot;feature layer&quot;</span> <span class="na">type=</span><span class="s">&quot;Vector&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>    <span class="nt">&lt;ol3source</span> <span class="na">source=</span><span class="s">&quot;Vector&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>      <span class="nt">&lt;ol3feature</span> <span class="na">geometry=</span><span class="s">&quot;Point&quot;</span> <span class="na">location=</span><span class="s">&quot;[-79, 40]&quot;</span><span class="nt">&gt;&lt;/ol3feature&gt;</span>
</span><span class='line'>      <span class="nt">&lt;ol3feature</span> <span class="na">geometry=</span><span class="s">&quot;Point&quot;</span> <span class="na">location=</span><span class="s">&quot;[-79, 40.009]&quot;</span><span class="nt">&gt;&lt;/ol3feature&gt;</span>
</span><span class='line'>      <span class="nt">&lt;ol3feature</span> <span class="na">geometry=</span><span class="s">&quot;Point&quot;</span> <span class="na">location=</span><span class="s">&quot;[-79, 40.005]&quot;</span><span class="nt">&gt;&lt;/ol3feature&gt;</span>
</span><span class='line'>    <span class="nt">&lt;/ol3source&gt;</span>
</span><span class='line'>  <span class="nt">&lt;/ol3layer&gt;</span>
</span><span class='line'><span class="nt">&lt;/ol3map&gt;</span>
</span></code></pre></td></tr></table></div></figure></p>

<p>I think this is a nice clear concise way of seeing the structure of the map, the layers will be added top to bottom and all the options are right there in the attributes.  Obviously this is incomplete, we don&rsquo;t have anyway to really pass styling to the features or layer currently.  But this works great when you want to quickly make some maps with basic settings.</p>

<p>Here is a working example:</p>

<iframe width="100%" height="600" src="//jsfiddle.net/timh06/ma5j990n/embedded/result,js,html/" allowfullscreen="allowfullscreen" frameborder="0"></iframe>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[OL3 Element Using KnockoutJs]]></title>
    <link href="http://thostetler.github.io/blog/2016/02/07/first-ol3-map/"/>
    <updated>2016-02-07T23:25:10-05:00</updated>
    <id>http://thostetler.github.io/blog/2016/02/07/first-ol3-map</id>
    <content type="html"><![CDATA[<iframe
  width="100%"
  height="300"
  src="//jsfiddle.net/timh06/8030x8ms/embedded/result,js,html/"
  allowfullscreen="allowfullscreen"
  frameborder="0"
></iframe>


<p>If you&rsquo;ve used something like polymer or knockout before, you&rsquo;ve seen HTML5
custom components, they are really cool.  The goal here is to create something
like this in your markup, for this we&rsquo;re going to use Knockout custom
components:</p>

<p><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='html'><span class='line'><span class="nt">&lt;ol3map&gt;&lt;/ol3map&gt;</span>
</span></code></pre></td></tr></table></div></figure></p>

<p>Then use the <code>KnockoutJs</code> simple custom component system to create the OL3
map.  If you haven&rsquo;t done so already, take a look over the custom component
section on <a href="http://knockoutjs.com/documentation%0A/component-overview.html">Knockout Components</a>.  Let&rsquo;s start by creating the component
registration:</p>

<p><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='js'><span class='line'><span class="nx">ko</span><span class="p">.</span><span class="nx">components</span><span class="p">.</span><span class="nx">register</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">lsquo</span><span class="p">;</span><span class="nx">ol3map</span><span class="o">&amp;</span><span class="nx">rsquo</span><span class="p">;,</span> <span class="p">{</span>
</span><span class='line'>  <span class="nx">viewModel</span><span class="o">:</span> <span class="p">{</span>
</span><span class='line'>    <span class="nx">createViewModel</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">params</span><span class="p">,</span> <span class="nx">componentInfo</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>      <span class="k">return</span> <span class="k">new</span> <span class="nx">MapViewModel</span><span class="p">(</span><span class="nx">params</span><span class="p">,</span> <span class="nx">componentInfo</span><span class="p">.</span><span class="nx">element</span><span class="p">);</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>  <span class="p">},</span>
</span><span class='line'>  <span class="nx">template</span><span class="o">:</span> <span class="o">&amp;</span><span class="nx">lsquo</span><span class="p">;</span><span class="c">&lt;!--</span> <span class="o">--&gt;&amp;</span><span class="nx">rsquo</span><span class="p">;</span>
</span><span class='line'><span class="p">});</span>
</span></code></pre></td></tr></table></div></figure></p>

<p>We want to then create our new <code>MapViewModel</code> object, this will be the context
that will be bound to the template we provide.  This is important, since OL3
won&rsquo;t initialize on hidden elements, we&rsquo;ll have to do some additional work to
get it to show up.</p>

<p><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='js'><span class='line'><span class="kd">function</span> <span class="nx">MapViewModel</span> <span class="p">(</span><span class="nx">options</span><span class="p">,</span> <span class="nx">element</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>  <span class="k">this</span><span class="p">.</span><span class="nx">map</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">ol</span><span class="p">.</span><span class="nx">Map</span><span class="p">({</span>
</span><span class='line'>    <span class="nx">view</span><span class="o">:</span> <span class="k">new</span> <span class="nx">ol</span><span class="p">.</span><span class="nx">View</span><span class="p">({</span>
</span><span class='line'>      <span class="nx">center</span><span class="o">:</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
</span><span class='line'>      <span class="nx">zoom</span><span class="o">:</span> <span class="mi">2</span>
</span><span class='line'>    <span class="p">})</span>
</span><span class='line'>  <span class="p">});</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure></p>

<p>In the <code>MapViewModel</code> we want to create a new <code>ol.Map</code> object with <em>no</em> target
set yet.  We&rsquo;ll do that in a custom binding handler that will do the job of
connecting the two.</p>

<p>Now let&rsquo;s set up the custom binding handler:</p>

<p><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='js'><span class='line'><span class="nx">ko</span><span class="p">.</span><span class="nx">bindingHandlers</span><span class="p">.</span><span class="nx">__map</span> <span class="o">=</span> <span class="p">{</span>
</span><span class='line'>    <span class="nx">init</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">element</span><span class="p">,</span> <span class="nx">valueAccessor</span><span class="p">,</span> <span class="nx">allBindings</span><span class="p">,</span> <span class="nx">viewModel</span><span class="p">,</span> <span class="nx">bindingContext</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>        <span class="nx">viewModel</span><span class="p">.</span><span class="nx">map</span><span class="p">.</span><span class="nx">setTarget</span><span class="p">(</span><span class="nx">element</span><span class="p">);</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'><span class="p">};</span>
</span></code></pre></td></tr></table></div></figure></p>

<p>This binding handler will allow us to do something like
<code>&lt;div data-bind="__map"&gt;&lt;/div&gt;</code> and get back the element and the viewmodel.
Once it&rsquo;s called we know the element exists, so we can attach our map at that
point. Also, prepending with <code>__</code> helps to keep us from possibly overwriting
other handlers.  Finally, let&rsquo;s change our template to include the new
binding.</p>

<p><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='js'><span class='line'><span class="nx">ko</span><span class="p">.</span><span class="nx">components</span><span class="p">.</span><span class="nx">register</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">lsquo</span><span class="p">;</span><span class="nx">ol3map</span><span class="o">&amp;</span><span class="nx">rsquo</span><span class="p">;,</span> <span class="p">{</span>
</span><span class='line'>  <span class="nx">viewModel</span><span class="o">:</span> <span class="p">{</span>
</span><span class='line'>    <span class="nx">createViewModel</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">params</span><span class="p">,</span> <span class="nx">componentInfo</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>      <span class="k">return</span> <span class="k">new</span> <span class="nx">MapViewModel</span><span class="p">(</span><span class="nx">params</span><span class="p">,</span> <span class="nx">componentInfo</span><span class="p">.</span><span class="nx">element</span><span class="p">);</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>  <span class="p">},</span>
</span><span class='line'>  <span class="nx">template</span><span class="o">:</span> <span class="o">&amp;</span><span class="nx">lsquo</span><span class="p">;</span><span class="o">&lt;</span><span class="nx">div</span> <span class="nx">data</span><span class="o">-</span><span class="nx">bind</span><span class="o">=</span><span class="s2">&quot;__map&quot;</span><span class="o">&gt;&lt;</span><span class="err">/div&gt;&amp;rsquo;</span>
</span><span class='line'><span class="p">});</span>
</span></code></pre></td></tr></table></div></figure></p>

<p>That&rsquo;s it! now when we place a <code>&lt;ol3map&gt;&lt;/ol3map&gt;</code> tag somewhere in our page
Knockout will call our viewmodel code, which will create the object containing
that <code>map</code> property.  When the template is applied, it is bound to the new
viewmodel context which should be something like <code>{ map: ol.Map(...) }</code>, then
the <code>__map</code> binding handler is called with this object passed as the
<code>viewmodel</code> param.  Finally, we call <code>setTarget(element)</code> on the map object we
got from the passed in viewmodel and the map gets initialized.  The final code
looks like this:</p>

<p><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
</pre></td><td class='code'><pre><code class='js'><span class='line'><span class="nx">ko</span><span class="p">.</span><span class="nx">bindingHandlers</span><span class="p">.</span><span class="nx">__map</span> <span class="o">=</span> <span class="p">{</span>
</span><span class='line'>    <span class="nx">init</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">element</span><span class="p">,</span> <span class="nx">valueAccessor</span><span class="p">,</span> <span class="nx">allBindings</span><span class="p">,</span> <span class="nx">viewModel</span><span class="p">,</span> <span class="nx">bindingContext</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>        <span class="nx">viewModel</span><span class="p">.</span><span class="nx">map</span><span class="p">.</span><span class="nx">setTarget</span><span class="p">(</span><span class="nx">element</span><span class="p">);</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'><span class="p">};</span><span class="o">&lt;</span><span class="err">/p&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="nx">p</span><span class="o">&gt;</span><span class="kd">function</span> <span class="nx">MapViewModel</span> <span class="p">(</span><span class="nx">options</span><span class="p">,</span> <span class="nx">element</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>  <span class="k">this</span><span class="p">.</span><span class="nx">map</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">ol</span><span class="p">.</span><span class="nx">Map</span><span class="p">({</span>
</span><span class='line'>    <span class="nx">view</span><span class="o">:</span> <span class="k">new</span> <span class="nx">ol</span><span class="p">.</span><span class="nx">View</span><span class="p">({</span>
</span><span class='line'>      <span class="nx">center</span><span class="o">:</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
</span><span class='line'>      <span class="nx">zoom</span><span class="o">:</span> <span class="mi">2</span>
</span><span class='line'>    <span class="p">}),</span>
</span><span class='line'>    <span class="nx">layers</span><span class="o">:</span> <span class="p">[</span>
</span><span class='line'>      <span class="k">new</span> <span class="nx">ol</span><span class="p">.</span><span class="nx">layer</span><span class="p">.</span><span class="nx">Tile</span><span class="p">({</span> <span class="nx">source</span><span class="o">:</span> <span class="k">new</span> <span class="nx">ol</span><span class="p">.</span><span class="nx">source</span><span class="p">.</span><span class="nx">OSM</span><span class="p">()</span> <span class="p">})</span>
</span><span class='line'>    <span class="p">]</span>
</span><span class='line'>  <span class="p">});</span>
</span><span class='line'><span class="p">}</span><span class="o">&lt;</span><span class="err">/p&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="nx">p</span><span class="o">&gt;</span><span class="c1">// Create the custom component</span>
</span><span class='line'><span class="nx">ko</span><span class="p">.</span><span class="nx">components</span><span class="p">.</span><span class="nx">register</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">lsquo</span><span class="p">;</span><span class="nx">ol3map</span><span class="o">&amp;</span><span class="nx">rsquo</span><span class="p">;,</span> <span class="p">{</span>
</span><span class='line'>  <span class="nx">viewModel</span><span class="o">:</span> <span class="p">{</span>
</span><span class='line'>    <span class="nx">createViewModel</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">params</span><span class="p">,</span> <span class="nx">componentInfo</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>      <span class="k">return</span> <span class="k">new</span> <span class="nx">MapViewModel</span><span class="p">(</span><span class="nx">params</span><span class="p">,</span> <span class="nx">componentInfo</span><span class="p">.</span><span class="nx">element</span><span class="p">);</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>  <span class="p">},</span>
</span><span class='line'>  <span class="nx">template</span><span class="o">:</span> <span class="o">&amp;</span><span class="nx">lsquo</span><span class="p">;</span><span class="o">&lt;</span><span class="nx">div</span> <span class="nx">data</span><span class="o">-</span><span class="nx">bind</span><span class="o">=</span><span class="s2">&quot;__map&quot;</span><span class="o">&gt;&lt;</span><span class="err">/div&gt;&amp;rsquo;</span>
</span><span class='line'><span class="p">});</span><span class="o">&lt;</span><span class="err">/p&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="nx">p</span><span class="o">&gt;</span><span class="nx">ko</span><span class="p">.</span><span class="nx">applyBindings</span><span class="p">({});</span>
</span></code></pre></td></tr></table></div></figure></p>
]]></content>
  </entry>
  
</feed>
